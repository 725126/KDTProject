<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/basic/home.html}">
<head>
  <meta charset="UTF-8">
  <title>자재ON - 홈(외부)</title>
  <link rel="stylesheet" th:href="@{/css/page/user/home.css}">
</head>
<body>
<th:block layout:fragment="external-home">
  <!-- 계약 미확인 알림 -->
  <div class="alert-box bg-white danger-notice p-3 mb-4 rounded-3 d-flex align-items-center">
    <i class="bi bi-file-earmark-excel-fill me-3 text-danger fs-4"></i>
    <div class="flex-grow-1">
      <div class="fw-semibold">계약서 확인 필요</div>
      <div class="text-muted small">계약번호 #CT-2091이 아직 확인되지 않았습니다. 시스템에서 검토 바랍니다.</div>
    </div>
    <a href="/contracts/view/CT-2091" class="btn btn-sm btn-outline-danger ms-3">
      자세히
    </a>
  </div>

  <div class="row g-4 mb-4">
    <!-- 계약 진행 건수 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-file-earmark-text kpi-icon"></i>
        <div>
          <div class="kpi-title">계약 진행</div>
          <div class="kpi-value">5건</div>
        </div>
      </div>
    </div>

    <!-- 견적 승인률 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-pie-chart kpi-icon"></i>
        <div>
          <div class="kpi-title">견적 승인률</div>
          <div class="kpi-value">83%</div>
        </div>
      </div>
    </div>

    <!-- 진척검수 완료율 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-check2-circle kpi-icon"></i>
        <div>
          <div class="kpi-title">검수 완료율</div>
          <div class="kpi-value">91%</div>
        </div>
      </div>
    </div>

    <!-- 재고 부족 품목 수 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-exclamation-triangle kpi-icon"></i>
        <div>
          <div class="kpi-title">재고 부족</div>
          <div class="kpi-value">3종</div>
        </div>
      </div>
    </div>

    <!-- 이번 달 거래 총액 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-currency-dollar kpi-icon"></i>
        <div>
          <div class="kpi-title">월 거래 금액</div>
          <div class="kpi-value">₩12,540,000</div>
        </div>
      </div>
    </div>

    <!-- 계약 갱신 임박 -->
    <div class="col-md-2">
      <div class="kpi-card">
        <i class="bi bi-calendar-event kpi-icon"></i>
        <div>
          <div class="kpi-title">갱신 임박</div>
          <div class="kpi-value">2건</div>
        </div>
      </div>
    </div>

  </div>



  <!-- 3. 작업 리스트/알림 -->
  <div class="row g-3">

    <div class="container-fluid pt-4">
      <div class="row g-4">
        <!-- 왼쪽 섹션 -->
        <div class="col-md-4">
          <div class="left-section d-flex flex-column justify-content-start">
            <div class="card p-4 today-schedule">
              <h5 class="fw-bold mb-3"><i class="bi bi-alarm"></i> 오늘의 일정</h5>

              <!-- 일정 항목 -->
              <!-- 일정 항목: 견적 제출 마감 -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <div class="fw-semibold">견적 제출 마감</div>
                  <div class="text-muted small">08:00 · 시스템 제출</div>
                </div>
                <span class="badge rounded-pill bg-success-subtle text-success">완료</span>
              </div>

              <!-- 일정 항목: 진척 검수 일정 -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <div class="fw-semibold">진척 검수 대응</div>
                  <div class="text-muted small">10:30 · 라인 A · 담당자: 김민수</div>
                </div>
                <span class="badge rounded-pill bg-warning-subtle text-warning">진행 중</span>
              </div>

              <!-- 일정 항목: 계약서 확인 -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <div class="fw-semibold">계약서 확인</div>
                  <div class="text-muted small">13:00 · 계약 담당자 · 문서함</div>
                </div>
                <span class="badge rounded-pill bg-primary-subtle text-primary">예정</span>
              </div>

            </div>

            <div class="spacer"></div>

            <div class="card p-4">
              <h5 class="fw-bold mb-3"><i class="bi bi-box-arrow-up-right"></i> 바로가기</h5>
              <div class="d-grid gap-2">

                <!-- 견적 등록 -->
                <div class="col-12">
                  <a href="#"
                     class="btn btn-light border w-100 d-flex align-items-center justify-content-center gap-1 small rounded-3 py-2">
                    <i class="bi bi-pencil-square text-primary"></i> 견적 등록
                  </a>
                </div>

                <!-- 계약 내역 확인 -->
                <div class="col-12">
                  <a href="#"
                     class="btn btn-light border w-100 d-flex align-items-center justify-content-center gap-1 small rounded-3 py-2">
                    <i class="bi bi-file-earmark-text text-success"></i> 계약 내역
                  </a>
                </div>

                <!-- 검수 일정 확인 -->
                <div class="col-12">
                  <a href="#"
                     class="btn btn-light border w-100 d-flex align-items-center justify-content-center gap-1 small rounded-3 py-2">
                    <i class="bi bi-calendar-check text-warning"></i> 검수 일정
                  </a>
                </div>

                <!-- 거래 명세서 조회 -->
                <div class="col-12">
                  <a href="#"
                     class="btn btn-light border w-100 d-flex align-items-center justify-content-center gap-1 small rounded-3 py-2">
                    <i class="bi bi-receipt text-info"></i> 거래 명세서
                  </a>
                </div>

              </div>
            </div>


          </div>
        </div>

        <!-- 오른쪽 섹션 -->
        <div class="col-md-8 d-flex flex-column calendar-container">
          <div class="card p-4">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-calendar"></i> 일정 캘린더
            </h5>
            <div class=" rounded p-4 text-center text-muted" id="calendar">
            </div>
          </div>
        </div>


        <!-- 그래프 -->
        <div class="col-md-6">
          <div class="card p-3">
            <div class="section-title">
              <h5 class="fw-bold ms-2 mt-2">
                <i class="bi bi-clock-history"></i> 납품 완료 vs 지연 추이
              </h5>
            </div>
            <canvas id="deliveryChart"></canvas>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card p-3">
            <div class="section-title">
              <h5 class="fw-bold ms-2 mt-2">
                <i class="bi bi-clipboard-check"></i> 월별 견적 승인률
              </h5>
            </div>
            <canvas id="approvalChart"></canvas>
          </div>
        </div>



      </div>
    </div>

  </div>

  <!-- 알림 모달 -->
  <div class="modal fade" id="alertDetailModal" tabindex="-1" aria-labelledby="alertDetailModalLabel"
       aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content rounded-4 shadow-sm">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" id="alertDetailModalLabel">입고 지연 상세 안내</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>
        <div class="modal-body">
          <table class="table table-bordered align-middle mb-0">
            <tbody>
            <tr>
              <th style="width: 30%" class="bg-light">자재 코드</th>
              <td>A-1023</td>
            </tr>
            <tr>
              <th class="bg-light">품목명</th>
              <td>고강도 스틸 플레이트</td>
            </tr>
            <tr>
              <th class="bg-light">예정 입고일</th>
              <td>2025-04-10</td>
            </tr>
            <tr>
              <th class="bg-light">지연 사유</th>
              <td>공급업체 운송 문제로 인한 2일 지연</td>
            </tr>
            <tr>
              <th class="bg-light">조치 사항</th>
              <td>대체 품목 전환 여부 검토 중</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">확인</button>
        </div>
      </div>
    </div>
  </div>


  <!-- 캘린더 모달 -->
  <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content rounded-4 shadow-sm">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" id="eventModalLabel">일정 상세</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>
        <div class="modal-body">
          <table class="table table-bordered align-middle mb-0">
            <tbody>
            <tr>
              <th class="bg-light" style="width: 30%">유형</th>
              <td><span id="modal-type"></span></td>
            </tr>
            <tr>
              <th class="bg-light">자재명</th>
              <td><span id="modal-item"></span></td>
            </tr>
            <tr>
              <th class="bg-light">기간</th>
              <td><span id="modal-dates"></span></td>
            </tr>
            <tr>
              <th class="bg-light">비고</th>
              <td><span id="modal-remarks"></span></td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">확인</button>
        </div>
      </div>
    </div>
  </div>

  <script th:src="@{/js/page/user/external-home.js}"></script>
</th:block>
</body>
</html>